{{ CUSTOM_CADDYFILE_PATCH }}
{% if CUSTOM_ALLOWED_HOSTS %}
{% for allowed_host in CUSTOM_ALLOWED_HOSTS %}{{ allowed_host ~ '{$default_site_port}' }}{%if not loop.last %}, {% endif %}{% endfor %} {
    @favicon_matcher {
        path_regexp ^/favicon.ico$
    }
    rewrite @favicon_matcher /theming/asset/images/favicon.ico

    # Limit profile image upload size
    handle_path /api/profile_images/*/*/upload {
        request_body {
            max_size 1MB
        }
    }

    import proxy "lms:8000"

    {{ patch("caddyfile-lms")|indent(4) }}

    handle_path /* {
        request_body {
            max_size 4MB
        }
    }
}
{% endif %}